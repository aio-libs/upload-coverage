name: 'Upload Image'
description: 'Uploade Docker image as an artifact'
inputs:
  artifact:
    description: 'The artifact name to store coverage chunk'
    required: false
    default: 'coverage'
  fail_ci_if_error:
    description: 'Fail CI if error'
    required: false
    default: true
runs:
  using: "composite"
  steps:
    - name: Download artifacts
      uses: actions/download-artifact@v2
      with:
        name: ${{ inputs.artifact }}
        path: coverage
    - name: Collect names
      id: meta
      run: |
        FILES=$(find coverage -type f -print0 | tr '\0' ' ')
        echo "::set-output name=files::${FILES# // /,}"
      shell: bash
    - name: Upload coverage
      uses: codecov/codecov-action@v2.1.0
      with:
        files: ${{ steps.meta.outputs.files }}
        fail_ci_if_error: ${{ inputs.fail_ci_if_error }}
